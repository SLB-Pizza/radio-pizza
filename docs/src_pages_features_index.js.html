

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> src/pages/features/index.js</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
             
                <a href="index.html">
                    <h1 class="navbar-item">HMBK Gatsby Docs</h1>
                </a>
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    API Documentation
                </a>
                
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Global</h3><ul><li><a href="global.html#addErrorToNotices">addErrorToNotices</a></li><li><a href="global.html#BottomNav">BottomNav</a></li><li><a href="global.html#CMSIssueMessageType">CMSIssueMessageType</a></li><li><a href="global.html#dateString">dateString</a></li><li><a href="global.html#displayCollectionPlaylistDetails">displayCollectionPlaylistDetails</a></li><li><a href="global.html#FallbackImage">FallbackImage</a></li><li><a href="global.html#FeaturesHighlightItems">FeaturesHighlightItems</a></li><li><a href="global.html#getCMSEntryName">getCMSEntryName</a></li><li><a href="global.html#getNavbarHeights">getNavbarHeights</a></li><li><a href="global.html#guide">guide</a></li><li><a href="global.html#HomeEvents">HomeEvents</a></li><li><a href="global.html#parseViewports">parseViewports</a></li><li><a href="global.html#playlistShuffle">playlistShuffle</a></li><li><a href="global.html#prioritySetter">prioritySetter</a></li><li><a href="global.html#processPublicationDates">processPublicationDates</a></li><li><a href="global.html#SingleFeatureCard">SingleFeatureCard</a></li><li><a href="global.html#sliceZone">sliceZone</a></li><li><a href="global.html#templateFieldCheck">templateFieldCheck</a></li><li><a href="global.html#TopicPageHero">TopicPageHero</a></li><li><a href="global.html#TopicPageHeroDetails">TopicPageHeroDetails</a></li><li><a href="global.html#TopicPageHighlightSection">TopicPageHighlightSection</a></li><li><a href="global.html#TopNav">TopNav</a></li><li><a href="global.html#UpcomingShow">UpcomingShow</a></li></ul></div><div class="category"><h2>CMS</h2><h3>Global</h3><ul><li><a href="global.html#ContentHelper">ContentHelper</a></li><li><a href="global.html#ImageHelper">ImageHelper</a></li><li><a href="global.html#ImageModal">ImageModal</a></li><li><a href="global.html#ResponsiveImage">ResponsiveImage</a></li></ul></div><div class="category"><h2>CMS
 Slices</h2><h3>Global</h3><ul><li><a href="global.html#ArticleHeadline">ArticleHeadline</a></li><li><a href="global.html#Blockquote">Blockquote</a></li><li><a href="global.html#FullWidthImage">FullWidthImage</a></li><li><a href="global.html#ImageRow">ImageRow</a></li><li><a href="global.html#OneImageAndText">OneImageAndText</a></li><li><a href="global.html#ParallaxHeadline">ParallaxHeadline</a></li><li><a href="global.html#TextBlock">TextBlock</a></li><li><a href="global.html#TwoImagesAndText">TwoImagesAndText</a></li></ul></div><div class="category"><h2>Layout Helper</h2><h3>Global</h3><ul><li><a href="global.html#EventHeader">EventHeader</a></li><li><a href="global.html#LeadFeatureDetails">LeadFeatureDetails</a></li><li><a href="global.html#ResidentBio">ResidentBio</a></li><li><a href="global.html#SingleResident">SingleResident</a></li><li><a href="global.html#TagButtons">TagButtons</a></li></ul></div><div class="category"><h2>LayoutHelper</h2><h3>Global</h3><ul><li><a href="global.html#LeadFeatureHero">LeadFeatureHero</a></li></ul></div><div class="category"><h2>Pages</h2><h3>Global</h3><ul><li><a href="global.html#CMSGuideIndex">CMSGuideIndex</a></li><li><a href="global.html#CollectionsIndexPage">CollectionsIndexPage</a></li><li><a href="global.html#EventsIndexPage">EventsIndexPage</a></li><li><a href="global.html#FeaturesIndex">FeaturesIndex</a></li><li><a href="global.html#IndexPage">IndexPage</a></li><li><a href="global.html#MixesIndexPage">MixesIndexPage</a></li><li><a href="global.html#ResidentIndex">ResidentIndex</a></li><li><a href="global.html#ScheduleIndexPage">ScheduleIndexPage</a></li><li><a href="global.html#SupportPage">SupportPage</a></li></ul></div><div class="category"><h2>Site Elements</h2><h3>Global</h3><ul><li><a href="global.html#DateSelectorButton">DateSelectorButton</a></li><li><a href="global.html#HeroCarousel">HeroCarousel</a></li><li><a href="global.html#HomeFeatures">HomeFeatures</a></li><li><a href="global.html#HomeMixes">HomeMixes</a></li><li><a href="global.html#MixPlayOverlay">MixPlayOverlay</a></li><li><a href="global.html#RadioPlayer">RadioPlayer</a></li><li><a href="global.html#ResidentSocialLinks">ResidentSocialLinks</a></li><li><a href="global.html#SingleScheduleEntryRow">SingleScheduleEntryRow</a></li><li><a href="global.html#SlideGenerator">SlideGenerator</a></li></ul></div><div class="category"><h2>Templates</h2><h3>Global</h3><ul><li><a href="global.html#CMSGuideTemplate">CMSGuideTemplate</a></li><li><a href="global.html#EventsTemplate">EventsTemplate</a></li><li><a href="global.html#FeatureTemplate">FeatureTemplate</a></li><li><a href="global.html#MixTemplate">MixTemplate</a></li><li><a href="global.html#ResidentTemplate">ResidentTemplate</a></li></ul></div><div class="category"><h2>Testing</h2><h3>Global</h3><ul><li><a href="global.html#PuppeteerTesting">PuppeteerTesting</a></li></ul></div><div class="category"><h2>Utilities</h2><h3>Global</h3><ul><li><a href="global.html#formatDateTime">formatDateTime</a></li><li><a href="global.html#formatNextShow">formatNextShow</a></li><li><a href="global.html#getBlockquoteStyling">getBlockquoteStyling</a></li><li><a href="global.html#getResidentLinks">getResidentLinks</a></li><li><a href="global.html#getResidentString">getResidentString</a></li><li><a href="global.html#htmlSerializer">htmlSerializer</a></li><li><a href="global.html#linkResolver">linkResolver</a></li><li><a href="global.html#makeCollectionDispatch">makeCollectionDispatch</a></li><li><a href="global.html#mappableDataFilter">mappableDataFilter</a></li><li><a href="global.html#SingleMixCard">SingleMixCard</a></li></ul></div><div class="category"><h2>Validation</h2><h3>Global</h3><ul><li><a href="global.html#cmsNodeValidator">cmsNodeValidator</a></li><li><a href="global.html#mixValidator">mixValidator</a></li><li><a href="global.html#uidAnalyzer">uidAnalyzer</a></li><li><a href="global.html#uidAssembler">uidAssembler</a></li><li><a href="global.html#uidValidator">uidValidator</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>src/pages/features/index.js</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { useEffect, useState } from 'react'
import { graphql } from 'gatsby'
import { RichText } from 'prismic-reactjs'
import {
  TopicPageHero,
  TopicPageHighlightSection,
  SingleFeatureCard,
} from '../../components'
import PropTypes from 'prop-types'
import { mixin } from 'lodash'

/**
 * @category Pages
 * @function FeaturesIndex
 * @param {object} data - the data object coming from Prismic CMS that contains all data needed to build the `/features` landing page
 */
function FeaturesIndex({ data }) {
  /**
   * Focus the node for the otherFeaturesData check below.
   */
  const featuresHeaderData = data.prismic.allLandingpages.edges[0].node
  const otherFeaturesData = data.prismic.allFeatures.edges

  /**
   * This line is here to prevent an error from occurring when you eventually deploy the site live. There is an issue with the preview functionality that requires this check on every page.
   * @see https://prismic.io/docs/gatsby/rendering/retrieve-the-document-object#21_0-adding-a-validation-check
   */
  if (!otherFeaturesData || !featuresHeaderData) return null

  const [featuresHeroData, setFeaturesHeroData] = useState(null)
  const [featuresHighlights, setFeaturesHighlights] = useState(null)
  const [featuresToMap, setFeaturesToMap] = useState(null)

  /**
   * The data from the 'FeaturesIndexPage' query comes pre-sorted to show the most recent published feature, NOT the most recently updated.
   *
   * The remaining array of node objects can be mapped over normally using XYZ_Component.
   */

  /**
   * Break down featuresHeaderData for {@link TopicPageHero} and {@link TopicPageHighlightSection}
   */
  useEffect(() => {
    const processFeaturesHeaderData = () => {
      // objects to pass to useState after processing
      let heroData = {}
      let highlightsData = {}

      let {
        features_page_header,
        features_page_subtitle,
        bottom_right_feature,
        top_right_feature,
        main_feature_article,
      } = featuresHeaderData

      const titling = RichText.asText(features_page_header) ?? 'features'

      /**
       * main_feature_article is null
       * - Shift off the first article from `allOtherFeatures` to use as main_feature_article
       */
      const allOtherFeatures = otherFeaturesData
      console.table(allOtherFeatures)

      if (!main_feature_article) {
        main_feature_article = allOtherFeatures.shift()
      }

      /**
       * Break down main_feature_article to designate {@link TopicPageHero} props and subcomponent props
       */
      const {
        article_headline,
        article_subtitle,
        article_category,
        article_subcategory,
        article_headline_img,
      } = main_feature_article.headline_block[0].primary

      /**
       * Assign default values if main_feature_article details unset
       */
      const title =
        RichText.asText(article_headline) ?? 'The latest from HMBK...'
      const subtitle = RichText.asText(article_subtitle) ?? ''
      const category = article_category ?? 'Feature'
      const subcategory = article_subcategory ?? ''

      const leadFeatureData = {
        linkDetails: main_feature_article._meta,
        leadTopicTitle: title,
        leadTopicSubtitle: subtitle,
        leadTopicCategory: category,
        leadTopicSubcategory: subcategory,
      }

      // Assign key-values to heroData from the processed main_feature_article
      heroData = {
        titling,
        bg: article_headline_img,
        data: leadFeatureData,
      }

      /**
       * Create /features highlightItemsData object from leftFeature and rightFeature using features from allOtherFeatures if necessary
       */

      if (!top_right_feature) {
        top_right_feature = allOtherFeatures.shift()
      }
      if (!bottom_right_feature) {
        bottom_right_feature = allOtherFeatures.shift()
      }

      /**
       * Build the highlightFeatures data object to pass to highlightsData
       */
      const highlightFeatures = {
        leftFeature: top_right_feature,
        rightFeature: bottom_right_feature,
      }

      const featuresSubheadline =
        RichText.asText(features_page_subtitle) ?? 'the hotlist'

      highlightsData = {
        data: highlightFeatures,
        titling: featuresSubheadline,
      }

      // Set featuresHeroData to the assembled heroData object
      // Set featuresHighlight to the assembled highlightsData object
      // Set featuresToMap to
      setFeaturesHeroData(heroData)
      setFeaturesHighlights(highlightsData)
      setFeaturesToMap(allOtherFeatures)
    }
    return processFeaturesHeaderData()
  }, [data])

  // Layout details for SingleFeatureCard
  const individualFeatureLayout = 'column is-12-mobile is-6-tablet is-4-desktop'

  return (
    &lt;main className="full-height-page" id="features">
      {/* Show only after featuresHeroData is processed by useEffect */
      featuresHeroData &amp;&amp; (
        &lt;TopicPageHero
          leadTopicData={featuresHeroData.data}
          leadTopicBG={featuresHeroData.bg}
          topicPageTitling={featuresHeroData.titling}
        />
      )}

      {/* Show only after featuresHighlights is processed by useEffect */
      featuresHighlights &amp;&amp; (
        &lt;TopicPageHighlightSection
          layoutType="features"
          highlightsData={featuresHighlights.data}
          highlightTitling={featuresHighlights.titling}
        />
      )}

      &lt;section className="section container is-fluid">
        &lt;div className="columns is-mobile is-multiline">
          {featuresToMap &amp;&amp;
            featuresToMap.map(({ node }, index) => (
              &lt;SingleFeatureCard
                key={`halfmoon-feature-${index}`}
                featureData={node}
                featureColumnLayout={individualFeatureLayout}
              />
            ))}
        &lt;/div>
      &lt;/section>
    &lt;/main>
  )
}

FeaturesIndex.propTypes = {
  leadFeatureData: PropTypes.exact({
    _meta: PropTypes.object.isRequired,
    body: PropTypes.arrayOf(PropTypes.object),
  }),
  allOtherFeatures: PropTypes.arrayOf(PropTypes.object),
}

export const query = graphql`
  query FeaturesIndexPage {
    prismic {
      allLandingpages {
        edges {
          node {
            features_page_header
            features_page_subtitle
            main_feature_article {
              ... on PRISMIC_Feature {
                _linkType
                _meta {
                  uid
                  type
                  lastPublicationDate
                  firstPublicationDate
                }
                headline_block {
                  ... on PRISMIC_FeatureHeadline_blockHeadline_block {
                    primary {
                      article_headline_img
                      article_headline
                      article_category
                      article_subcategory
                      article_subtitle
                    }
                  }
                }
              }
            }
            top_right_feature {
              ... on PRISMIC_Feature {
                _meta {
                  uid
                  type
                  lastPublicationDate
                  firstPublicationDate
                }
                headline_block {
                  ... on PRISMIC_FeatureHeadline_blockHeadline_block {
                    type
                    primary {
                      article_headline_img
                      article_headline
                      article_category
                      article_subtitle
                    }
                  }
                }
              }
            }
            bottom_right_feature {
              ... on PRISMIC_Feature {
                _linkType
                _meta {
                  uid
                  type
                  lastPublicationDate
                  firstPublicationDate
                }
                headline_block {
                  ... on PRISMIC_FeatureHeadline_blockHeadline_block {
                    primary {
                      article_headline_img
                      article_headline
                      article_category
                      article_subtitle
                    }
                  }
                }
              }
            }
          }
        }
      }
      allFeatures(sortBy: meta_firstPublicationDate_DESC) {
        edges {
          node {
            _meta {
              uid
              firstPublicationDate
              lastPublicationDate
              type
              tags
            }
            headline_block {
              ... on PRISMIC_FeatureHeadline_blockHeadline_block {
                primary {
                  article_headline_img
                  article_headline
                  article_subcategory
                  article_subtitle
                }
              }
            }
          }
        }
      }
    }
  }
`

export default FeaturesIndex
</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.5</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by 
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>

</body>
</html>
